@page
@model IndexModel

@section Styles {
<partial name="_DataTableStyles" />
}
@{
	ViewData["Title"] = Localizer["Audit Logs"];
	ViewData["ActiveMainPage"] = "AuditTrail";
	ViewData["Level1"] = "Admin";
}
<div class="card">
	<div class="card-body">
		<table id="AuditLogs" class="table table-hover table-bordered table-striped responsive nowrap" width="100%">
			<thead>
				<tr>
					<th>
						@Html.DisplayNameFor(model => model.AuditLog.DateTime)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.AuditLog.TableName)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.AuditLog.Type)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.AuditLog.PrimaryKey)
					</th>
				</tr>
			</thead>
		</table>
	</div>
</div>
<a id="back-to-top" href="#" class="btn btn-primary back-to-top" role="button" aria-label="Scroll to top">
	<i class="fas fa-chevron-up"></i>
</a>
@section Scripts {
<partial name="_DataTableScripts" />
<script asp-add-nonce>
	$(document).ready(function () {
		var table = $('#AuditLogs').DataTable({
			select: false,
			serverSide: true,
			order: [[ 0, 'desc' ]],
			ajax:
			{
				url: '@Url.Page("/AuditTrail/Index", new { area = "Admin", handler = "ListAll" })',
				type: "POST",
				headers: {
					RequestVerificationToken:
						$('input:hidden[name="__RequestVerificationToken"]').val()
				},
			},
			columns: [
				{
					data: "dateTime",
					name: "DateTime",
					searchable: false,
					render: function (data, type, row, meta) {
						var url = '@Url.Page("/AuditTrail/Details", new { area = "Admin" })' + '?id=' + row.id;
						return '<a href="' + url + '">' + $.format.toBrowserTimeZone(data, 'dd/MM/yyyy hh:mm:ss a') + '</a>';
					},
				},
				{ data: "tableName", name: "TableName" },
				{ data: "type", name: "Type" },
				{ data: "primaryKey", name: "PrimaryKey", visible: false, },
				{ data: "userId", name: "UserId", visible: false, },
			],
			buttons: [
				'excel', 'pdf', 'pageLength',
			],
		});
		var debounce = new $.fn.dataTable.Debounce(table); // Add delay to search
	});
</script>
}